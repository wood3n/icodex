---
title: TS类型声明文件
---

## d.ts

环境声明文件通常是以`.d.ts`结尾的一份 TypeScript 格式的文件，它们一般被放在项目的根目录，或者通过`package.json`的`typings`/`types`属性指定其定义的路径：

```json
{
  "typings": "lib/index.d.ts"
}
```

对于环境声明文件内部每个根级别的变量，函数声明等都必须使用 TypeScript 的`declare`（声明）关键字作为前缀，`declare`声明语法是隐藏内部实现细节的做法，也就是只会暴露函数，变量等类型，参数等，例如声明`jQuery`的全局变量：

```typescript
// src/jQuery.d.ts

declare let jQuery: (selector: string) => any;
```

对于`.d.ts`格式的文件，在发布 package 的时候，TypeScript 也不会对其进行编译，从而在其它项目将其作为第三方库使用的时候，能够通过 TypeScript 引用它的声明文件，**获得对应的代码补全、接口提示等功能**。

## 创建声明文件

### 自动生成

如果库本身使用 TypeScript 编写的，可以在 TypeScript 的配置文件`tsconfig.json`中添加 `declaration` 选项，就可以在项目构建的同时自动生成 `.d.ts` 声明文件，该声明文件也会被保存到`outDir`指定的文件目录中。

```json
{
  "compilerOptions": {
    "module": "commonjs",
    "outDir": "lib",
    "declaration": true
  }
}
```

除此之外，还有几个和声明文件相关的`tsconfig.json`配置项：

- `declarationDir` 设置生成 `.d.ts` 文件的目录
- `declarationMap` 对每个 `.d.ts` 文件，都生成对应的 `.d.ts.map`（sourcemap）文件
- `emitDeclarationOnly` 仅生成 `.d.ts` 文件，不生成 `.js` 文件

### 手动添加

对于一些没有使用 TypeScript 编写的项目，可以选择手动添加声明文件的方式：

- 一种方法是直接在项目根目录添加`index.d.ts` 文件，手动编写项目的类型声明；
- 另一种方式是通过`package.json` 中的 `types` 或 `typings` 字段指定一个类型声明文件的路径

## 发布声明文件

可以通过上面的方法为自己的 TypeScript 项目自动生成声明文件，并在发布库的时候跟随项目自动发布，但是为一些老的第三方库，

甚至是已经停止维护的库添加类型声明是一件很麻烦的事，所以 TypeScript 团队提供了 [DefinitelyTyped](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/README.cn.md) 类型声明仓库，为没有声明

文件的 JavaScript 库提供类型定义，任何想为第三方库添加类型声明文件的 GitHub 成员都可以通过提 PR 的形式为该仓库提供代码，

每一个 PR 在合并之前都会由 TypeScript 或 Definitely Typed 的团队成员进行审核，然后合并后的 `master`分支会被自动发布到

NPM 上的 `@types`下，这样我们就可以通过安装`@types/<package name>`的形式去安装第三方库的类型声明文件了。

例如 React 库本身没有自己的声明文件，就可以通过 DefinitelyTyped 获取它的声明文件。

```shell
yarn add @types/react -D
```
